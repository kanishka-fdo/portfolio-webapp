<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::section}, 'Project Form')}">

<section>
    <div class="mb-4">
        <a th:href="@{/admin}" class="text-decoration-none">
            <i class="bi bi-arrow-left"></i> Back to Dashboard
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-4">
            <h1 class="h4 fw-bold mb-4" th:text="${project.id != null ? 'Edit Project' : 'New Project'}">Project Form</h1>

            <form th:action="@{/admin/projects/save}" th:object="${project}" method="post">
                <input type="hidden" th:field="*{id}">

                <div class="row g-3">
                    <!-- Title -->
                    <div class="col-md-8">
                        <label class="form-label">Project Title *</label>
                        <input type="text" class="form-control" th:field="*{title}"
                               placeholder="e.g., E-commerce Platform" required maxlength="200">
                    </div>

                    <!-- Featured Toggle -->
                    <div class="col-md-4">
                        <label class="form-label">Featured Project</label>
                        <div class="form-check form-switch" style="padding-top: 0.5rem;">
                            <input class="form-check-input" type="checkbox" th:field="*{featured}"
                                   id="featuredSwitch" style="width: 3rem; height: 1.5rem; cursor: pointer;">
                            <label class="form-check-label ms-2" for="featuredSwitch">
                                <span class="badge text-bg-primary" th:if="*{featured}">Featured</span>
                                <span class="text-muted" th:unless="*{featured}">Regular</span>
                            </label>
                        </div>
                    </div>

                    <!-- Subtitle -->
                    <div class="col-12">
                        <label class="form-label">Subtitle</label>
                        <input type="text" class="form-control" th:field="*{subtitle}"
                               placeholder="Brief tagline or summary" maxlength="300">
                        <small class="text-muted">A short tagline that appears below the title</small>
                    </div>

                    <!-- Short Description -->
                    <div class="col-12">
                        <label class="form-label">Short Description *</label>
                        <textarea class="form-control" th:field="*{shortDescription}" rows="2"
                                  placeholder="Brief overview for project cards" required maxlength="500"></textarea>
                        <small class="text-muted">This appears on project cards and listings</small>
                    </div>

                    <!-- Full Description -->
                    <div class="col-12">
                        <label class="form-label">Full Description</label>
                        <textarea class="form-control" th:field="*{description}" rows="6"
                                  placeholder="Detailed project description, features, and implementation details..."></textarea>
                        <small class="text-muted">Detailed description shown on the project detail page</small>
                    </div>

                    <!-- Tech Stack -->
                    <div class="col-md-6">
                        <label class="form-label">Tech Stack *</label>
                        <input type="text" class="form-control" th:field="*{techStack}"
                               placeholder="e.g., React, Node.js, MongoDB" required maxlength="300">
                        <small class="text-muted">Comma-separated technologies used</small>
                    </div>

                    <!-- Image URL -->
                    <div class="col-md-6">
                        <label class="form-label">Image URL</label>
                        <input type="url" class="form-control" th:field="*{imageUrl}"
                               placeholder="https://example.com/image.jpg" maxlength="500">
                        <small class="text-muted">Project screenshot or thumbnail</small>
                    </div>

                    <!-- GitHub URL -->
                    <div class="col-md-6">
                        <label class="form-label">GitHub Repository</label>
                        <input type="url" class="form-control" th:field="*{githubUrl}"
                               placeholder="https://github.com/username/repo" maxlength="500">
                    </div>

                    <!-- Live URL -->
                    <div class="col-md-6">
                        <label class="form-label">Live Demo URL</label>
                        <input type="url" class="form-control" th:field="*{liveUrl}"
                               placeholder="https://project-demo.com" maxlength="500">
                    </div>
                </div>

                <!-- Image Preview -->
                <div class="mt-4" id="imagePreview" style="display: none;">
                    <label class="form-label">Image Preview</label>
                    <div class="border rounded-3 p-3 bg-light">
                        <img id="previewImg" src="" alt="Preview" class="img-fluid rounded" style="max-height: 300px;">
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="d-flex gap-2 justify-content-end mt-4 pt-3 border-top">
                    <a th:href="@{/admin}" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Save Project
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<script>
    // Image preview functionality
    const imageUrlInput = document.querySelector('input[name="imageUrl"]');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');

    if (imageUrlInput && imagePreview && previewImg) {
        // Show preview on page load if URL exists
        if (imageUrlInput.value) {
            previewImg.src = imageUrlInput.value;
            imagePreview.style.display = 'block';
        }

        // Update preview when URL changes
        imageUrlInput.addEventListener('input', function() {
            if (this.value) {
                previewImg.src = this.value;
                imagePreview.style.display = 'block';
            } else {
                imagePreview.style.display = 'none';
            }
        });

        // Handle image load errors
        previewImg.addEventListener('error', function() {
            imagePreview.style.display = 'none';
        });
    }
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</html>